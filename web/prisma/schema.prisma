generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model account {
  id         String   @id @map("_id")
  accountId  String
  createdAt  DateTime @db.Date
  password   String
  providerId String
  updatedAt  DateTime @db.Date
  userId     String
}

model audit_logs {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  /// Entity name or collection referenced by this audit entry
  entidade    String?
  /// ID of the entity referenced by this audit entry (likely an ObjectId)
  entidade_id String? @db.ObjectId
  /// When the audit event happened
  timestamp   DateTime? @db.Date

  @@index([entidade, entidade_id])
  @@index([timestamp])
}

model contratos_mutuo {
  id              String @id @default(auto()) @map("_id") @db.ObjectId
  /// Status of the contract (e.g. draft, funded, active, closed)
  status_contrato String?
  /// Reference to `tomadores` (ObjectId)
  tomador_id      String? @db.ObjectId

  @@index([tomador_id, status_contrato])
}

model covenants_violados {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  /// Reference to `contratos_mutuo` (ObjectId)
  contrato_id   String? @db.ObjectId
  /// When the covenant was violated
  data_violacao DateTime? @db.Date

  @@index([contrato_id, data_violacao])
}

model dados_bancarios {
  id           String @id @default(auto()) @map("_id") @db.ObjectId
  /// Type of user this banking data belongs to (e.g. 'investidor'|'tomador')
  tipo_usuario String?
  /// Reference to user (investidor/tomador) stored as ObjectId
  usuario_id   String? @db.ObjectId

  @@unique([usuario_id, tipo_usuario])
}

model historicos_financeiros {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  /// Period this historical record refers to (month/year)
  periodo    DateTime? @db.Date
  /// Reference to `tomadores` (ObjectId)
  tomador_id String? @db.ObjectId

  @@index([tomador_id, periodo])
}

model investidores {
  id                      String @id @default(auto()) @map("_id") @db.ObjectId
  /// Investor identification document (CPF/CNPJ)
  documento_identificacao String?  @unique
  /// Reference to auth/user id (ObjectId)
  uid_usuario             String?  @db.ObjectId @unique
}

model investimentos {
  id            String @id @default(auto()) @map("_id") @db.ObjectId
  /// Reference to `contratos_mutuo` (ObjectId)
  contrato_id   String? @db.ObjectId
  /// Reference to `investidores` (ObjectId)
  investidor_id String? @db.ObjectId

  @@unique([contrato_id, investidor_id])
  @@index([contrato_id])
  @@index([investidor_id])
}

model metricas_mensais {
  id             String @id @default(auto()) @map("_id") @db.ObjectId
  /// Month reference for the metric (use a Date for the month start)
  mes_referencia DateTime? @db.Date
  /// Reference to `tomadores` (ObjectId)
  tomador_id     String? @db.ObjectId

  @@unique([tomador_id, mes_referencia])
  @@index([tomador_id])
}

model metricas_tempo_real {
  id                String @id @default(auto()) @map("_id") @db.ObjectId
  /// When the metric was captured
  timestamp_captura DateTime? @db.Date
  /// Reference to `tomadores` (ObjectId)
  tomador_id        String? @db.ObjectId

  @@index([tomador_id, timestamp_captura])
}

model repagamentos {
  id             String @id @default(auto()) @map("_id") @db.ObjectId
  /// Reference to `contratos_mutuo` (ObjectId)
  contrato_id    String? @db.ObjectId
  /// Date when payment happened
  data_pagamento DateTime? @db.Date

  @@index([contrato_id, data_pagamento])
}

model repasses_investidor {
  id             String @id @default(auto()) @map("_id") @db.ObjectId
  /// Reference to `investidores` (ObjectId)
  investidor_id  String? @db.ObjectId
  /// Reference to `repagamentos` (ObjectId)
  repagamento_id String? @db.ObjectId

  @@index([repagamento_id])
  @@index([investidor_id])
}

model scorings_tomador {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  /// When the score was created
  criado_em  DateTime? @db.Date
  /// Reference to `tomadores` (ObjectId)
  tomador_id String? @db.ObjectId

  @@index([tomador_id, criado_em])
}

model session {
  id        String   @id @map("_id")
  createdAt DateTime @db.Date
  expiresAt DateTime @db.Date
  ipAddress String
  token     String   @unique
  updatedAt DateTime @db.Date
  userAgent String
  userId    String
}

model tomadores {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  /// CNPJ of the borrower
  cnpj        String?  @unique
  /// Reference to auth/user id (ObjectId)
  uid_usuario String?  @db.ObjectId @unique
}

model user {
  id            String   @id @map("_id")
  createdAt     DateTime @db.Date
  email         String   @unique
  emailVerified Boolean
  name          String
  role          String
  updatedAt     DateTime @db.Date
}

model verification {
  id String @id @default(auto()) @map("_id") @db.ObjectId
}
